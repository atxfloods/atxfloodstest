(function(b){b.fn.formbuilder=function(h){var f={save_url:false,load_url:false,control_box_target:false,serialize_prefix:"vfd",messages:{save:"Save Form Layout",text:"Text Field",picker:"Datepicker Field",uploader:"File Attachment",title:"Title",paragraph:"Paragraph",checkboxes:"Checkboxes",radio:"Radio",select:"Select List",datepicker:"DatePicker",text_field:"Text Field",label:"Label",paragraph_field:"Paragraph Field",select_options:"Select Options",add:"Add",checkbox_group:"Checkbox Group",remove_message:"Are you sure you want to remove this element?",remove:"Remove",radio_group:"Radio Group",selections_message:"Allow Multiple Selections",hide:"Hide",required:"Required",show:"Show",cancel:"Cancel"}};var g=b.extend(f,h);var a="form_builder-"+b("ul[id^=form_builder-]").length++;return this.each(function(){var E=b(this).append('<ul id="'+a+'" class="form"></ul>').find("ul");var O="";var M="";var I=1;b(E).addClass(a);if(g.load_url){b.ajax({type:"GET",url:g.load_url,success:function(j){H(j)}})}var F=function(k){var n="";var l="";var j="";var o=a+"-control-box";var m=a+"-save-button";n+='<a href ="#" id="input_text">'+g.messages.text+"</a>";n+='<a href ="#" id="textarea">'+g.messages.paragraph+"</a>";n+='<a href ="#" id="checkbox">'+g.messages.checkboxes+"</a>";n+='<a href ="#" id="radio">'+g.messages.radio+"</a>";n+='<a href ="#" id="select">'+g.messages.select+"</a>";n+='<a href ="#" id="datepicker">'+g.messages.datepicker+"</a>";n+='<a href ="#" id="uploader">'+g.messages.uploader+"</a>";l='<div id="'+o+'" class="form_builder-control">'+n+"</div>";j='<input type="submit" id="'+m+'" class="button button-green" value="'+g.messages.save+'"/>';j+='<a href="index.php?do=forms" class="button-alt" style="margin-left:20px">'+g.messages.cancel+"</a>";if(!k){b(E).before(l)}else{b(k).append(l)}b(E).after(j);b("#"+m).click(function(){C();return false});b("#"+o+" a").click(function(){K(b(this).attr("id"));b("html, body").animate({scrollTop:b("#form-"+(I-1)+"-item").offset().top},500);return false})}(g.control_box_target);var H=function(m){var l="";var j=false;var k=false;b(m).each(function(){if(this.cssClass==="checkbox"){j=[this.title];l=[];b.each(this.values,function(){l.push([this.value,this.baseline])})}else{if(this.cssClass==="radio"){j=[this.title];l=[];b.each(this.values,function(){l.push([this.value,this.baseline])})}else{if(this.cssClass==="select"){j=[this.title,this.multiple];l=[];b.each(this.values,function(){l.push([this.value,this.baseline])})}else{if(this.cssClass==="datepicker"){l=[this.values]}else{if(this.cssClass==="uploader"){l=[this.values]}else{l=[this.values]}}}}}K(this.cssClass,l,j,this.required)})};var K=function(m,l,j,k){O="";M=m;if(typeof(l)==="undefined"){l=""}switch(m){case"input_text":D(l,k);break;case"textarea":z(l,k);break;case"checkbox":c(l,j,k);break;case"radio":G(l,j,k);break;case"select":N(l,j,k);break;case"datepicker":e(l,k);break;case"uploader":A(l,k);break}};var D=function(k,j){O+="<label>"+g.messages.label+"</label>";O+='<input class="fld-title inputbox" id="title-'+I+'" type="text" value="'+k+'" />';J(g.messages.text,O,j)};var z=function(k,j){O+="<label>"+g.messages.label+"</label>";O+='<input class="inputbox" type="text" value="'+k+'" />';J(g.messages.paragraph_field,O,j)};var e=function(k,j){O+="<label>"+g.messages.label+"</label>";O+='<input class="fld-title inputbox pickdate" id="title-'+I+'" type="text" value="'+k+'"';O+='style="background-image: url(../images/calendar.png); background-repeat: no-repeat; background-position: 99% center;"/>';J(g.messages.picker,O,j)};var A=function(k,j){O+="<label>"+g.messages.label+"</label>";O+='<input class="fld-title inputbox pickfile" id="title-'+I+'" type="text" value="'+k+'"';O+='style="background-image: url(../images/attachment.png); background-repeat: no-repeat; background-position: 99% center;"/>';J(g.messages.uploader,O,j)};var c=function(l,j,k){var m="";if(typeof(j)==="object"){m=j[0]}O+='<div class="chk_group">';O+='<div class="form-fld"><label>'+g.messages.title+"</label>";O+='<input type="text" class="inputbox" name="title" value="'+m+'" /></div>';O+='<div class="false-label">'+g.messages.select_options+"</div>";O+='<div class="fields">';if(typeof(l)==="object"){for(i=0;i<l.length;i++){O+=B(l[i])}}else{O+=B("")}O+='<div class="add-area"><a href="#" class="add-checkbox tooltip" title="'+g.messages.add+'"><img src="'+SITEURL+'/images/add.png" /></a></div>';O+="</div>";O+="</div>";J(g.messages.checkbox_group,O,k)};var B=function(k){var j=false;var l="";if(typeof(k)==="object"){l=k[0];j=(k[1]==="false"||k[1]==="undefined")?false:true}O="";O+="<div>";O+='<input type="checkbox"'+(j?' checked="checked"':"")+" />";O+='<input type="text" class="inputbox" value="'+l+'" />';O+='<a href="#" class="remove tooltip" title="'+g.messages.remove+'"><img src="'+SITEURL+'/images/delete.png" /></a>';O+="</div>";return O};var G=function(l,j,k){var m="";if(typeof(j)==="object"){m=j[0]}O+='<div class="rd_group">';O+='<div class="form-fld"><label>'+g.messages.title+"</label>";O+='<input type="text" class="inputbox" name="title" value="'+m+'" /></div>';O+='<div class="false-label">'+g.messages.select_options+"</div>";O+='<div class="fields">';if(typeof(l)==="object"){for(i=0;i<l.length;i++){O+=d(l[i],"form-"+I+"-fld")}}else{O+=d("","form-"+I+"-fld")}O+='<div class="add-area"><a href="#" class="add-radio tooltip" title="'+g.messages.add+'"><img src="'+SITEURL+'/images/add.png" /></a></div>';O+="</div>";O+="</div>";J(g.messages.radio_group,O,k)};var d=function(l,j){var m=false;var k="";if(typeof(l)==="object"){k=l[0];m=(l[1]==="false"||l[1]==="undefined")?false:true}O="";O+="<div>";O+='<input type="radio"'+(m?' checked="checked"':"")+' name="radio_'+j+'" />';O+='<input type="text" class="inputbox" value="'+k+'" />';O+='<a href="#" class="remove tooltip" title="'+g.messages.remove+'"><img src="'+SITEURL+'/images/delete.png" /></a>';O+="</div>";return O};var N=function(j,n,k){var m=false;var l="";if(typeof(n)==="object"){l=n[0];m=n[1]==="checked"?true:false}O+='<div class="opt_group">';O+='<div class="form-fld"><label>'+g.messages.title+"</label>";O+='<input type="text" class="inputbox" name="title" value="'+l+'" /></div>';O+="";O+='<div class="false-label">'+g.messages.select_options+"</div>";O+='<div class="fields">';O+='<input type="checkbox" name="multiple"'+(m?'checked="checked"':"")+">";O+='<label class="auto">'+g.messages.selections_message+"</label>";if(typeof(j)==="object"){for(i=0;i<j.length;i++){O+=L(j[i],m)}}else{O+=L("",m)}O+='<div class="add-area"><a href="#" class="add-option tooltip" title="'+g.messages.add+'"><img src="'+SITEURL+'/images/add.png" /></a></div>';O+="</div>";O+="</div>";J(g.messages.select,O,k)};var L=function(j,k){if(k){return B(j)}else{return d(j)}};var J=function(l,j,m){if(m){m=m==="checked"?true:false}var k="";k+='<li id="form-'+I+'-item" class="'+M+'">';k+='<div class="legend">';k+='<a id="form-'+I+'" class="toggle-form" href="#" title="'+g.messages.hide+'"><img src="'+SITEURL+'/images/down.png" class="img-wrap"/></a>';k+='<a id="del_'+I+'" class="del-button delete-confirm tooltip" href="#" title="'+g.messages.remove+'"><span><img src="'+SITEURL+'/images/trash.png" class="img-wrap" /></span></a>';k+='<strong id="txt-title-'+I+'">'+l+"</strong></div>";k+='<div id="form-'+I+'-fld" class="form-holder">';k+='<div class="form-elements">';k+='<div class="form-fld"><label for="required-'+I+'">'+g.messages.required+"</label>";k+='<input class="required" type="checkbox" value="1" name="required-'+I+'" id="required-'+I+'"'+(m?' checked="checked"':"")+" /></div>";k+=O;k+="</div>";k+="</div>";k+="</li>";b(E).append(k);I++};b(".remove").live("click",function(){b(this).parent("div").animate({opacity:"hide",height:"hide",marginBottom:"0px"},"fast",function(){b(this).remove()});return false});b(".toggle-form").live("click",function(){var j=b(this).attr("id");if(b(this).attr("title")==g.messages.hide){b(this).html('<img src="'+SITEURL+'/images/up.png" class="img-wrap"/>').attr("title",g.messages.show);b("#"+j+"-fld").slideToggle("fast");return false}if(b(this).attr("title")==g.messages.show){b(this).html('<img src="'+SITEURL+'/images/down.png" class="img-wrap"/>').attr("title",g.messages.hide);b("#"+j+"-fld").slideToggle("fast");return false}return false});b("a.delete-confirm").live("click",function(){var j=b(this).attr("id").replace(/del_/,"");var l=b(this).parent().parent();var k=g.messages.del;b("#dialog-confirm").data({delid:j,parent:l}).dialog("open");return false});b("#dialog-confirm").dialog({resizable:false,bgiframe:true,autoOpen:false,width:400,height:"auto",zindex:9998,modal:false,buttons:{Remove:function(){var j=b(this).data("parent");var k=b(this).data("delid");b("#form-"+k+"-item").animate({backgroundColor:"#FFBFBF"},400);b("#form-"+k+"-item").fadeOut(400,function(){j.remove()});b(this).dialog("close")},Cancel:function(){b(this).dialog("close")}}});b(".add-checkbox").live("click",function(){b(this).parent().before(B());return false});b(".add-option").live("click",function(){b(this).parent().before(L("",false));return false});b(".add-radio").live("click",function(){b(this).parent().before(d(false,b(this).parents(".form-holder").attr("id")));return false});var C=function(){if(g.save_url){b.ajax({type:"POST",url:g.save_url,data:b(E).serializeFormList({prepend:g.serialize_prefix}),success:function(j){b("html, body").animate({scrollTop:0},600);b("#msgholder").html(j)}})}}})}})(jQuery);(function(b){b.fn.serializeFormList=function(h){var f={prepend:"ul",is_child:false,attributes:["class"]};var g=b.extend(f,h);if(!g.is_child){g.prepend="&"+g.prepend}var a="";this.each(function(){var e=this;var d=0;var c=1;b(this).children().each(function(){for(att=0;att<g.attributes.length;att++){var k=(g.attributes[att]==="class"?"cssClass":g.attributes[att]);a+=g.prepend+"["+d+"]["+k+"]="+encodeURIComponent(b(this).attr(g.attributes[att]));if(g.attributes[att]==="class"){a+=g.prepend+"["+d+"][required]="+encodeURIComponent(b("#"+b(this).attr("id")+" input.required").attr("checked"));switch(b(this).attr(g.attributes[att])){case"input_text":a+=g.prepend+"["+d+"][values]="+encodeURIComponent(b("#"+b(this).attr("id")+" input[type=text]").val());break;case"datepicker":a+=g.prepend+"["+d+"][values]="+encodeURIComponent(b("#"+b(this).attr("id")+" input[type=text]").val());break;case"uploader":a+=g.prepend+"["+d+"][values]="+encodeURIComponent(b("#"+b(this).attr("id")+" input[type=text]").val());break;case"textarea":a+=g.prepend+"["+d+"][values]="+encodeURIComponent(b("#"+b(this).attr("id")+" input[type=text]").val());break;case"checkbox":c=1;b("#"+b(this).attr("id")+" input[type=text]").each(function(){if(b(this).attr("name")==="title"){a+=g.prepend+"["+d+"][title]="+encodeURIComponent(b(this).val())}else{a+=g.prepend+"["+d+"][values]["+c+"][value]="+encodeURIComponent(b(this).val());a+=g.prepend+"["+d+"][values]["+c+"][baseline]="+b(this).prev().attr("checked")}c++});break;case"radio":c=1;b("#"+b(this).attr("id")+" input[type=text]").each(function(){if(b(this).attr("name")==="title"){a+=g.prepend+"["+d+"][title]="+encodeURIComponent(b(this).val())}else{a+=g.prepend+"["+d+"][values]["+c+"][value]="+encodeURIComponent(b(this).val());a+=g.prepend+"["+d+"][values]["+c+"][baseline]="+b(this).prev().attr("checked")}c++});break;case"select":c=1;a+=g.prepend+"["+d+"][multiple]="+b("#"+b(this).attr("id")+" input[name=multiple]").attr("checked");b("#"+b(this).attr("id")+" input[type=text]").each(function(){if(b(this).attr("name")==="title"){a+=g.prepend+"["+d+"][title]="+encodeURIComponent(b(this).val())}else{a+=g.prepend+"["+d+"][values]["+c+"][value]="+encodeURIComponent(b(this).val());a+=g.prepend+"["+d+"][values]["+c+"][baseline]="+b(this).prev().attr("checked")}c++});break}}}d++})});return(a)}})(jQuery);